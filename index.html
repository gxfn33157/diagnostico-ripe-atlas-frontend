<body>
  <h1>Diagn√≥stico de Acesso</h1>

  <input id="dominio" placeholder="ex: google.com" />
  <button id="btn">Diagnosticar</button>

  <div id="loading" style="display:none; margin-top:10px;">
    üîÑ Executando diagn√≥stico global...
    <div
      id="barra"
      style="width:0%; height:10px; background:#4caf50; margin-top:5px;"
    ></div>
  </div>

  <pre id="resultado">Aguardando...</pre>

  <script type="module">
    import { diagnosticarDominio } from "/src/api.ts";

    const btn = document.getElementById("btn");
    const resultado = document.getElementById("resultado");
    const loading = document.getElementById("loading");
    const barra = document.getElementById("barra");

    btn.addEventListener("click", async () => {
      const dominio = document.getElementById("dominio").value;

      resultado.textContent = "";
      loading.style.display = "block";
      barra.style.width = "0%";

      let progresso = 0;
      const timer = setInterval(() => {
        progresso = Math.min(progresso + 10, 90);
        barra.style.width = progresso + "%";
      }, 1000);

      try {
        const data = await diagnosticarDominio(dominio);
        clearInterval(timer);
        barra.style.width = "100%";
        loading.style.display = "none";

        resultado.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        clearInterval(timer);
        loading.style.display = "none";
        resultado.textContent = "‚ùå Erro ao executar diagn√≥stico";
      }
    });
  </script>
</body>
